<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de F√≠sica - F√≥rmulas Matem√°ticas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìê</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: white;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
            gap: 1rem;
            padding: 1rem;
        }
        
        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1rem;
        }
        
        .card-header {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            color: #22d3ee;
        }
        
        .editor {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        textarea {
            flex: 1;
            background: #0f172a;
            color: #e2e8f0;
            border: 1px solid #475569;
            border-radius: 4px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            resize: none;
            outline: none;
        }
        
        .controls {
            display: flex;
            gap: 0.5rem;
        }
        
        button {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-simulate {
            background: #10b981;
            color: white;
        }
        
        .btn-simulate:hover {
            background: #059669;
        }
        
        .btn-reset {
            background: #64748b;
            color: white;
        }
        
        .btn-reset:hover {
            background: #475569;
        }
        
        canvas {
            width: 100%;
            background: #0f172a;
            border-radius: 4px;
        }
        
        .telemetry {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .metric {
            background: #0f172a;
            padding: 0.5rem;
            border-radius: 4px;
        }
        
        .metric-label {
            color: #94a3b8;
            font-size: 0.75rem;
        }
        
        .metric-value {
            color: #22d3ee;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .error {
            background: #7f1d1d;
            border: 1px solid #991b1b;
            color: #fca5a5;
            padding: 0.75rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        .success {
            background: #064e3b;
            border: 1px solid #065f46;
            color: #6ee7b7;
            padding: 0.75rem;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
        }
        
        .help {
            background: #1e293b;
            padding: 0.75rem;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #cbd5e1;
            margin-top: 0.5rem;
        }
        
        .help-title {
            color: #22d3ee;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #0f172a;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Painel Esquerdo -->
        <div class="panel">
            <div class="card">
                <div class="card-header">üìê Editor de F√≥rmulas F√≠sicas</div>
                <div class="help">
                    <div class="help-title">Como usar:</div>
                    <div>1. Defina valores: <code>v0 = 20</code></div>
                    <div>2. Equa√ß√µes: <code>y = v0*t - 0.5*g*t^2</code></div>
                    <div>3. Use: <code>t</code>, <code>^</code>, <code>sqrt()</code>, <code>sin()</code></div>
                </div>
            </div>
            
            <div class="card editor">
                <textarea id="formulaInput" spellcheck="false"># Desafio: Subida Vertical
# Fa√ßa o objeto subir 15 metros

# Valores iniciais
v0 = 20        # velocidade inicial (m/s)
g = 9.8        # gravidade (m/s¬≤)
x0 = 0         # posi√ß√£o inicial em x
y0 = 0         # posi√ß√£o inicial em y

# Equa√ß√µes do movimento
# t √© a vari√°vel tempo (autom√°tica)

# Posi√ß√£o
x = x0
y = y0 + v0*t - 0.5*g*t^2

# Velocidade
vx = 0
vy = v0 - g*t

# Acelera√ß√£o
ax = 0
ay = -g</textarea>
                <div id="errorDisplay"></div>
            </div>
            
            <div class="card">
                <div class="controls">
                    <button class="btn-simulate" onclick="simulate()">‚ñ∂Ô∏è Simular</button>
                    <button class="btn-reset" onclick="reset()">üîÑ Reset</button>
                </div>
            </div>
        </div>
        
        <!-- Painel Direito -->
        <div class="panel">
            <div class="card">
                <div class="card-header">üìä Visualiza√ß√£o</div>
                <canvas id="canvas" width="600" height="400"></canvas>
                <div id="successDisplay"></div>
            </div>
            
            <div class="card">
                <div class="card-header">üìà Telemetria</div>
                <div class="telemetry">
                    <div class="metric">
                        <div class="metric-label">Tempo</div>
                        <div class="metric-value" id="time">0.00s</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Altura M√°xima</div>
                        <div class="metric-value" id="maxHeight">0.00m</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Posi√ß√£o X</div>
                        <div class="metric-value" id="posX">0.00m</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Posi√ß√£o Y</div>
                        <div class="metric-value" id="posY">0.00m</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Velocidade X</div>
                        <div class="metric-value" id="velX">0.00m/s</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Velocidade Y</div>
                        <div class="metric-value" id="velY">0.00m/s</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let animationId = null;
        let trajectory = [];
        let maxHeight = 0;
        
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        function parseFormulas(input) {
            const lines = input.split('\n');
            const constants = {};
            const formulas = {};
            
            for (let line of lines) {
                line = line.trim();
                
                // Ignora coment√°rios e linhas vazias
                if (line.startsWith('#') || line === '') continue;
                
                // Processa atribui√ß√µes
                if (line.includes('=')) {
                    const [left, right] = line.split('=').map(s => s.trim());
                    
                    // Se o lado direito n√£o cont√©m 't', √© uma constante
                    if (!right.includes('t')) {
                        try {
                            constants[left] = math.evaluate(right, constants);
                        } catch (e) {
                            throw new Error(`Erro ao avaliar constante "${left}": ${e.message}`);
                        }
                    } else {
                        // √â uma f√≥rmula com t
                        formulas[left] = right;
                    }
                }
            }
            
            return { constants, formulas };
        }
        
        function evaluateAtTime(formulas, constants, t) {
            const scope = { ...constants, t };
            const results = {};
            
            // Avalia cada f√≥rmula
            for (let [variable, formula] of Object.entries(formulas)) {
                try {
                    results[variable] = math.evaluate(formula, scope);
                } catch (e) {
                    throw new Error(`Erro em "${variable}": ${e.message}`);
                }
            }
            
            return results;
        }
        
        function simulate() {
            reset();
            
            const input = document.getElementById('formulaInput').value;
            const errorDisplay = document.getElementById('errorDisplay');
            const successDisplay = document.getElementById('successDisplay');
            
            errorDisplay.innerHTML = '';
            successDisplay.innerHTML = '';
            
            try {
                const { constants, formulas } = parseFormulas(input);
                
                // Verifica se tem as vari√°veis necess√°rias
                if (!formulas.x && !formulas.y) {
                    throw new Error('Defina pelo menos uma equa√ß√£o de posi√ß√£o (x ou y)');
                }
                
                let t = 0;
                const dt = 0.016; // 60 FPS
                const maxTime = 10;
                
                function animate() {
                    if (t > maxTime) {
                        return;
                    }
                    
                    try {
                        const values = evaluateAtTime(formulas, constants, t);
                        
                        const pos = {
                            x: values.x || 0,
                            y: values.y || 0
                        };
                        
                        const vel = {
                            x: values.vx || 0,
                            y: values.vy || 0
                        };
                        
                        const acc = {
                            x: values.ax || 0,
                            y: values.ay || 0
                        };
                        
                        // Atualiza telemetria
                        document.getElementById('time').textContent = t.toFixed(2) + 's';
                        document.getElementById('posX').textContent = pos.x.toFixed(2) + 'm';
                        document.getElementById('posY').textContent = pos.y.toFixed(2) + 'm';
                        document.getElementById('velX').textContent = vel.x.toFixed(2) + 'm/s';
                        document.getElementById('velY').textContent = vel.y.toFixed(2) + 'm/s';
                        
                        maxHeight = Math.max(maxHeight, pos.y);
                        document.getElementById('maxHeight').textContent = maxHeight.toFixed(2) + 'm';
                        
                        // Adiciona √† trajet√≥ria
                        trajectory.push({ x: pos.x, y: pos.y, t });
                        
                        // Desenha
                        drawScene(pos, vel, acc);
                        
                        // Verifica objetivo (15m de altura)
                        if (maxHeight >= 15 && !successDisplay.innerHTML) {
                            successDisplay.innerHTML = '<div class="success">üéâ OBJETIVO ALCAN√áADO! Altura ‚â• 15m üéâ</div>';
                        }
                        
                        // Para se sair dos limites ou voltar ao ch√£o
                        if (pos.y < -1 || Math.abs(pos.x) > 100 || Math.abs(pos.y) > 100) {
                            return;
                        }
                        
                        t += dt;
                        animationId = requestAnimationFrame(animate);
                        
                    } catch (e) {
                        errorDisplay.innerHTML = `<div class="error">‚ö†Ô∏è ${e.message}</div>`;
                    }
                }
                
                animate();
                
            } catch (e) {
                errorDisplay.innerHTML = `<div class="error">‚ö†Ô∏è ${e.message}</div>`;
            }
        }
        
        function reset() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            trajectory = [];
            maxHeight = 0;
            
            document.getElementById('time').textContent = '0.00s';
            document.getElementById('maxHeight').textContent = '0.00m';
            document.getElementById('posX').textContent = '0.00m';
            document.getElementById('posY').textContent = '0.00m';
            document.getElementById('velX').textContent = '0.00m/s';
            document.getElementById('velY').textContent = '0.00m/s';
            document.getElementById('errorDisplay').innerHTML = '';
            document.getElementById('successDisplay').innerHTML = '';
            
            // Limpa canvas
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function drawScene(pos, vel, acc) {
            const width = canvas.width;
            const height = canvas.height;
            
            // Limpa
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(0, 0, width, height);
            
            // Configura√ß√£o de escala
            const scale = 8;
            const originX = 50;
            const originY = height - 50;
            
            // Grid
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= width; x += scale * 5) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= height; y += scale * 5) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Eixos
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, originY);
            ctx.lineTo(width, originY);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.moveTo(originX, 0);
            ctx.lineTo(originX, height);
            ctx.stroke();
            
            // Linha de objetivo (15m)
            const targetY = originY - 15 * scale;
            ctx.strokeStyle = '#22d3ee';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, targetY);
            ctx.lineTo(width, targetY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            ctx.fillStyle = '#22d3ee';
            ctx.font = '14px monospace';
            ctx.fillText('Meta: 15m', 10, targetY - 5);
            
            // Trajet√≥ria
            if (trajectory.length > 1) {
                ctx.strokeStyle = '#60a5fa';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                trajectory.forEach((point, i) => {
                    const x = originX + point.x * scale;
                    const y = originY - point.y * scale;
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.stroke();
            }
            
            // Objeto
            const objX = originX + pos.x * scale;
            const objY = originY - pos.y * scale;
            
            ctx.fillStyle = maxHeight >= 15 ? '#10b981' : '#f59e0b';
            ctx.beginPath();
            ctx.arc(objX, objY, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // Vetores
            const velScale = 3;
            const accScale = 10;
            
            // Velocidade (azul)
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(objX, objY);
            ctx.lineTo(objX + vel.x * velScale, objY - vel.y * velScale);
            ctx.stroke();
            
            // Acelera√ß√£o (vermelho)
            ctx.strokeStyle = '#ef4444';
            ctx.beginPath();
            ctx.moveTo(objX, objY);
            ctx.lineTo(objX + acc.x * accScale, objY - acc.y * accScale);
            ctx.stroke();
        }
        
        // Inicializa canvas
        reset();
    </script>
</body>
</html>
